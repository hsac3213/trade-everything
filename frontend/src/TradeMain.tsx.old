import React, { useState } from 'react';
import OrderBook from './OrderBook';
import Pair from './Pair';
import TradePrice from './TradePrice';
import Earn from './Earn';
import Assets from './Assets';

interface TradeMainProps {
  onLogout?: () => void;
}

// --- ë©”ì¸ ê±°ë˜ ì»´í¬ë„ŒíŠ¸ ---
const TradeMain: React.FC<TradeMainProps> = ({ onLogout }) => {
  const [exchange, setExchange] = useState<string>('Binance');
  const [activeMenu, setActiveMenu] = useState<string>('Trade');
  const [symbol, setSymbol] = useState<string>('btcusdt');
  
  // ê±°ë˜ì†Œ ë³€ê²½ í•¸ë“¤ëŸ¬
  const handleExchangeChange = (newExchange: string) => {
    console.log(`ğŸ”„ Changing exchange from ${exchange} to ${newExchange}`);
    
    // 1. ê±°ë˜ì†Œ ë³€ê²½
    setExchange(newExchange);
    
    // 2. ì‹¬ë³¼ ì´ˆê¸°í™” (ê° ê±°ë˜ì†Œì˜ ê¸°ë³¸ ì‹¬ë³¼ë¡œ)
    const defaultSymbol = getDefaultSymbol(newExchange);
    setSymbol(defaultSymbol);
    
    console.log(`âœ… Exchange changed to ${newExchange}, symbol reset to ${defaultSymbol}`);
  };
  
  // ê±°ë˜ì†Œë³„ ê¸°ë³¸ ì‹¬ë³¼ ë°˜í™˜
  const getDefaultSymbol = (exchangeName: string): string => {
    switch (exchangeName) {
      case 'Binance':
      case 'UPBit':
        return 'btcusdt';
      case 'KIS':
        return '005930'; // ì‚¼ì„±ì „ì
      default:
        return 'btcusdt';
    }
  };

  // ë©”ë‰´ë³„ ì»¨í…ì¸  ë Œë”ë§
  const renderContent = () => {
    switch (activeMenu) {
      case 'Trade':
        return (
          <>
            {/* ë¡œê³  + ë©”ë‰´ íƒ­ */}
            <div className="flex items-center gap-6">
              <h1 className="text-3xl font-bold text-gray-100">
                Trade Everything
              </h1>
              <div className="flex gap-1">
                {['Trade', 'Earn', 'Assets'].map((menu) => (
                  <button
                    key={menu}
                    onClick={() => setActiveMenu(menu)}
                    className={`px-4 py-2 text-sm font-medium rounded transition-colors ${
                      activeMenu === menu
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white'
                    }`}
                  >
                    {menu}
                  </button>
                ))}
              </div>
            </div>
            
            <div className="flex flex-col lg:flex-row gap-6">
              {/* ì™¼ìª½: ê±°ë˜ì†Œ ì„ íƒ + í˜¸ê°€ì°½ */}
              <aside className="w-full lg:w-[300px] flex flex-col gap-3">
                {/* ê±°ë˜ì†Œ ì„ íƒ ì½¤ë³´ë°•ìŠ¤ */}
                <select
                  id="exchange-select"
                  value={exchange}
                  onChange={(e) => handleExchangeChange(e.target.value)}
                  className="bg-gray-800 text-white border border-gray-600 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer"
                >
                  <option value="Binance">Binance</option>
                  <option value="KIS">KIS</option>
                  <option value="UPBit">UPBit</option>
                </select>
                
                <OrderBook broker={exchange} symbol={symbol} key={`orderbook-${exchange}-${symbol}`} />
              </aside>

              {/* ì˜¤ë¥¸ìª½: ê±°ë˜ í˜ì–´ ì„ íƒ & ì²´ê²°ê°€ê²© */}
              <aside className="w-full lg:w-[300px] flex flex-col gap-2">
                <Pair broker={exchange} key={`pair-${exchange}`} />
                <TradePrice broker={exchange} symbol={symbol} key={`tradeprice-${exchange}-${symbol}`} />
              </aside>
            </div>
          </>
        );
      
      case 'Earn':
        return (
          <>
            {/* ë¡œê³  + ë©”ë‰´ íƒ­ */}
            <div className="flex items-center gap-6">
              <h1 className="text-3xl font-bold text-gray-100">
                Trade Everything
              </h1>
              <div className="flex gap-1">
                {['Trade', 'Earn', 'Assets'].map((menu) => (
                  <button
                    key={menu}
                    onClick={() => setActiveMenu(menu)}
                    className={`px-4 py-2 text-sm font-medium rounded transition-colors ${
                      activeMenu === menu
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white'
                    }`}
                  >
                    {menu}
                  </button>
                ))}
              </div>
            </div>
            
            <Earn />
          </>
        );
      
      case 'Assets':
        return (
          <>
            {/* ë¡œê³  + ë©”ë‰´ íƒ­ */}
            <div className="flex items-center gap-6">
              <h1 className="text-3xl font-bold text-gray-100">
                Trade Everything
              </h1>
              <div className="flex gap-1">
                {['Trade', 'Earn', 'Assets'].map((menu) => (
                  <button
                    key={menu}
                    onClick={() => setActiveMenu(menu)}
                    className={`px-4 py-2 text-sm font-medium rounded transition-colors ${
                      activeMenu === menu
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white'
                    }`}
                  >
                    {menu}
                  </button>
                ))}
              </div>
            </div>
            
            <Assets />
          </>
        );
      
      default:
        return null;
    }
  };

  return (
    <div className="min-h-screen bg-gray-900 text-white p-4 lg:p-8 font-sans">
      <div className="flex flex-col gap-3 flex-1">
        {/* ë©”ì¸ ë ˆì´ì•„ì›ƒ - ë©”ë‰´ë³„ ì»¨í…ì¸  */}
        {renderContent()}
      </div>
    </div>
  );
}

export default TradeMain;
